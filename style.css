:root{
  --bg:#0b0f19; --card:#12182a; --glass:rgba(18,24,42,0.65); --text:#f3f6fb; --muted:#a7b1c2;
  --accent:#6aa6ff; --accent-2:#9bc2ff; --ok:#11c46a; --bad:#ff5468;
  --radius:16px; --space: clamp(10px, 2.4vw, 18px); --fz: clamp(15px, 1.9vw, 17px);
  --prompt-fz: clamp(18px, 4vw, 26px);
  --glow: 0 0 14px color-mix(in srgb, var(--accent) 40%, transparent), 0 0 30px color-mix(in srgb, var(--accent) 20%, transparent);
  --avatar-tint: rgba(106,166,255,.20);
  --avatar-glow: 0 0 18px rgba(106,166,255,.28);
  --loot-img: url("./LootAssets/TreasureChestDefault.png");
  --space: clamp(8px, 2vw, 14px);

   /* tweak to match your theme */
  --press-glow-color: #6aa6ff;
  --press-glow-spread: 18px;   /* max glow radius */
  --press-glow-duration: 380ms;

   /* NEW: glow system drives all buttons */
  --glow-hue: 220deg;
  --glow-intensity: 0.5;    /* 0..1; controlled by settings slider */
  --glow-color: hsl(var(--glow-hue) 100% 65% / calc(0.55 + var(--glow-intensity)*0.45));
  --glow-color-soft: hsl(var(--glow-hue) 90% 70% / calc(0.25 + var(--glow-intensity)*0.3));

  /* Gold palette */
  --gold-1:#fdf6d8;
  --gold-2:#ffe49a;
  --gold-3:#ffcf59;
  --gold-4:#d6a63b;
  --gold-5:#8f6b26;

  /* Glow + specular settings */
  --xp-gold-outer: 0 0 22px rgba(255, 206, 106, .35), 0 0 44px rgba(255, 220, 140, .20);
  --xp-gold-inner: inset 0 1px 0 rgba(255,255,255,.55), inset 0 -2px 6px rgba(0,0,0,.35);
  --xp-gold-bevel: inset 0 10px 20px rgba(255,255,255,.08), inset 0 -10px 24px rgba(0,0,0,.28);
  --xp-sheen-speed: 3.5s;
}



/* Themes */
html[data-theme="blue"]{ --accent:#6aa6ff; --accent-2:#9bc2ff; --avatar-tint: rgba(106,166,255,.18); }
html[data-theme="pink"]{ --accent:#ff78c4; --accent-2:#ffc2e3; --avatar-tint: rgba(255,120,196,.16); }
html[data-theme="burgundy"]{ --accent:#a33a4a; --accent-2:#cf6b7c; --avatar-tint: rgba(163,58,74,.16); }
html[data-theme="green"]{ --accent:#4bdc84; --accent-2:#9df2c0; --avatar-tint: rgba(75,220,132,.16); }
html[data-theme="yellow"]{ --accent:#ffd24d; --accent-2:#ffe9a1; --avatar-tint: rgba(255,210,77,.14); }

*{box-sizing:border-box}
html,body{
  margin:0; padding:0;
  background:linear-gradient(160deg,#0a0e18 0%,#0d1222 60%,#0b0f19 100%);
  color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; font-size:var(--fz);
  min-height:100%;
  overflow-x:hidden; /* prevent horizontal scroll on device window */
}
img{max-width:100%;display:block}

/* App Bar */
.appbar{ position:sticky; top:0; z-index:100; background:rgba(8,12,22,.78); backdrop-filter:blur(10px); border-bottom:1px solid #1c2540 }
.appbar-inner{
  max-width:min(1160px, 100vw - 2*var(--space));
  margin:0 auto; padding:12px var(--space);
  display:flex; gap:12px; align-items:center; justify-content:space-between;
}
.brand{ font-weight:800; letter-spacing:.4px; font-size:18px; text-decoration:none; color:var(--text); white-space:nowrap }
.nav{ display:flex; gap:10px; align-items:center; overflow-x:auto; -webkit-overflow-scrolling:touch }
.nav::-webkit-scrollbar{ display:none }
.nav-link{ color:var(--muted); text-decoration:none; padding:8px 12px; border-radius:10px; border:1px solid transparent; white-space:nowrap; flex:0 0 auto }
.nav-link:hover, .nav-link.active{ color:var(--text); border-color:#223055; background:rgba(255,255,255,.03) }

/* Layout */
.wrap{ max-width:min(1160px, 100%); margin:var(--space) auto; padding:0 var(--space); display:grid; gap:var(--space) }
.layout-single{ max-width:min(900px, 100%); margin:var(--space) auto; padding:0 var(--space) }
.card{ background:var(--glass); border:1px solid #1c2540; border-radius:var(--radius); padding:var(--space); box-shadow:0 10px 30px rgba(0,0,0,.25) }
.muted{ color:var(--muted) }

/* Remove streak/solving badges/rows entirely */
#solving, #streak, #streakRow, #streakWrap, .solving, .streak {
  display: none !important;
}

/* Stage (avatar + HUD) */
.stage{ display:grid; gap:var(--space); align-items:center; justify-items:center }
.hud-top{ width:100%; display:grid; place-items:center }
.xp-hud{ width:min(560px, 92%); display:grid; gap:8px; }
.xp-title{ text-align:center; font-weight:800; letter-spacing:.3px }
/*.xp-rail{ position:relative; height:14px; background:#0d1324; border:1px solid #233056; border-radius:999px; overflow:hidden; }*/
/* XP rail: darker, subtle metallic frame */
.xp-rail{
  position:relative;
  height:16px;
  border-radius:999px;
  background:
    linear-gradient(180deg, #0a0e19, #0c1222 55%, #0a0e19),
    radial-gradient(120% 100% at 50% 0%, rgba(255,255,255,.06), transparent 60%);
  border:1px solid #2a355a;
  box-shadow: inset 0 2px 6px rgba(0,0,0,.55), 0 8px 18px rgba(0,0,0,.25);
  overflow:hidden;
}

/*.xp-bar{ position:absolute; inset:0 auto 0 0; width:0; background:linear-gradient(90deg,var(--accent),var(--accent-2)); box-shadow:var(--glow); transition:width .6s cubic-bezier(.2,.8,.2,1) }*/

/* XP bar: gold “ingot” with depth, glow, and sheen */
.xp-bar{
  position:absolute;
  inset:0 auto 0 0;
  width:0;
  border-radius:999px;
  /* Layered backgrounds build the metallic look */
  background:
    /* specular rim (top) */
    linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,0) 45%) top/100% 55% no-repeat,
    /* warm body gradient */
    linear-gradient(180deg, var(--gold-2), var(--gold-3) 50%, var(--gold-4) 85%),
    /* subtle banding for metal */
    repeating-linear-gradient(90deg, rgba(255,255,255,.04) 0 8px, rgba(0,0,0,.04) 8px 16px);
  box-shadow: var(--xp-gold-outer), var(--xp-gold-inner), var(--xp-gold-bevel);
  transition:width .6s cubic-bezier(.2,.8,.2,1), filter .25s ease;
}

/* Add a moving diagonal sheen (3D highlight) */
.xp-bar::before{
  content:"";
  position:absolute; inset:-30% -10% -30% auto;
  width:28%;
  transform:skewX(-18deg);
  background:
    linear-gradient(90deg, rgba(255,255,255,0) 0%,
                           rgba(255,255,255,.55) 45%,
                           rgba(255,255,255,0) 100%);
  mix-blend-mode:screen;
  animation: xpSheen var(--xp-sheen-speed) linear infinite;
  opacity:.7;
  pointer-events:none;
}

/* Inner shadow at the bottom for curvature */
.xp-bar::after{
  content:"";
  position:absolute; inset:auto 0 0 0; height:45%;
  border-bottom-left-radius:999px; border-bottom-right-radius:999px;
  background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.22));
  pointer-events:none;
}
.xp-pulse{ position:absolute; inset:0; pointer-events:none; opacity:0 }
/*.xp-rail.pulse .xp-pulse{ animation:xpPulse 1200ms ease; } */

/* Gentle “charge” pulse when the rail has .pulse (you already toggle this) */
.xp-rail.pulse .xp-bar{
  filter: drop-shadow(0 0 10px rgba(255, 226, 140, .45))
          drop-shadow(0 0 22px rgba(255, 226, 140, .25));
}
@keyframes xpPulse{ 0%{opacity:.0} 15%{opacity:.8; box-shadow:inset 0 0 0 999px rgba(255,255,255,.0)} 100%{opacity:0} }

.avatar-area{
  display:grid; grid-template-columns: auto minmax(220px, 1fr); gap:18px; align-items:center;
  width:100%;
}
@media (max-width: 760px){
  .avatar-area{ grid-template-columns: 1fr; justify-items:center }
}
.loot-box{ display:grid; place-items:center; text-decoration:none; gap:6px }
/* Loot art now uses your PNG; gradient glows remain as a subtle background */
.loot-art, .loot-art.lg{
  background:
    radial-gradient(closest-side, rgba(255,233,141,.18), transparent 70%),
    var(--loot-img);                                /* your image */
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;                         /* keep aspect ratio */
  border-radius:12px;
  border:1px solid #5a3f18;
  box-shadow:0 0 20px rgba(255,210,77,.25);
  width:56px; height:56px;
}
.loot-art.lg{ width:80px; height:80px }
/* Optional alt style used on loot.html for the “science” card */
.loot-art.science{
  background:
    radial-gradient(closest-side, rgba(141,255,233,.16), transparent 70%),
    var(--loot-img);
  background-repeat:no-repeat;
  background-position:center;
  background-size:contain;
  border-color:#185a3f;
}
.loot-count{ font-weight:800; color:#ffd24d }

/* Avatar container: no window/frame */
.avatar-window{
  width: clamp(112px, 33.6vw, 252px);
  aspect-ratio: 1/1;
  position:relative;
  display:grid;
  place-items:center;
  border:none;                 /* was: 1px solid */
  border-radius:0;             /* remove rounded frame */
  background:transparent;      /* remove any backdrop */
  box-shadow:none;             /* remove drop shadow */
  overflow:visible;            /* let the avatar breathe */
}
/* Hide the previous tint layer entirely */
.avatar-bg{ display:none !important; }
/* Keep the stage simple; avatar sized by scale from JS */
.avatar-stage{
  position:relative;
  z-index:1;
  width:auto;
  height:auto;
  display:grid;
  place-items:center;
}
/* Pet still sits to the lower-right of the avatar if chosen */
.pet-stage{
  position:absolute;
  right:-4%;
  bottom:-2%;
  width:28%;
  height:28%;
  display:none;
  z-index:2;
}
.pet-stage.on{ display:block }
.char-name{ text-align:center; font-weight:800; letter-spacing:.3px; }

/* Controls */
.select, .btn, input[type="text"], input[type="number"], select{
  background:#0f1427; border:1px solid #223055; color:var(--text);
  padding:12px 14px; border-radius:12px; font-weight:700; max-width:100%;
}

/* Center the subject/topic picker row */
.topic-picker{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center; /* centered */
  flex-wrap:wrap;
  margin: 8px auto;
  width: min(760px, 100%);
}

/* Make selects consistent with your existing .select style */
.topic-picker select.select{
  min-width: 200px;
  text-align: left;
}


/* Buttons — upgraded */
.btn{
  background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 16%, #0f1528), #0a0f1f);
  border:1px solid color-mix(in srgb, var(--accent) 36%, #223055);
  box-shadow: 0 6px 16px rgba(0,0,0,.25), 0 0 0 0 rgba(0,0,0,0);
  transition: transform .12s, box-shadow .2s, border-color .2s, filter .2s;
  min-height:44px;
}
.btn:hover{ transform: translateY(-1px); box-shadow: var(--glow); border-color: var(--accent) }
.btn:active{ transform: translateY(0); filter: brightness(.95) }
.btn-primary{ background: linear-gradient(180deg, var(--accent), var(--accent-2)); color:#0b1020; border:none }
.btn-ghost{ background:transparent }

.only-mobile{ display:none }
@media (max-width: 760px){ .only-mobile{ display:inline-block } }

/* Drawer / Problem panel */
.drawer .prob-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
.prompt.pretty{
  min-height:64px; line-height:1.6; font-size:var(--prompt-fz);
  padding:10px 12px; border-radius:12px; background:rgba(255,255,255,0.02);
  border:1px dashed #223055; text-align:center; font-family: "JetBrains Mono", ui-monospace, monospace;
}
mjx-container[jax="CHTML"]{ font-size:120% !important }
.answer-row input{
  width:100%; font-family:"JetBrains Mono", ui-monospace, monospace; font-size:18px; text-align:center
}
.feedback{ min-height:28px; margin-top:10px; font-weight:800; text-align:center }
.feedback.ok{ color:var(--ok) } .feedback.bad{ color:var(--bad) }

/* On-screen Keyboard */
.kbd{ margin-top:10px; display:none }
.kbd.open{ display:block }
.kbd-grid{ display:grid; grid-template-columns: repeat(6, 1fr); gap:8px }
.kbd-grid button{ padding:12px 10px; border-radius:10px; border:1px solid #223055; background:#0f1528; color:var(--text); font-weight:800; letter-spacing:.2px }
.kbd-grid .wide{ grid-column: span 2 }
.kbd-grid .primary{ background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#0b1020; border:none }
.kbd-grid .accent{ color:#0b1020; background:linear-gradient(180deg,#ffd24d,#ffe9a1); border:none }
.kbd-grid .danger{ border-color:#3b2330; background:#1b0f16; color:#ffb1c1 }

.press-glow{
  position: relative; /* needed for the pseudo-element */
  /* optional subtle default shadow */
  transition: box-shadow 120ms ease;
}

/* Glow layer */
.press-glow::after{
  content: "";
  position: absolute;
  inset: -2px;               /* slightly outside the button edge */
  border-radius: inherit;
  pointer-events: none;
  opacity: 0;
  box-shadow: 0 0 0 var(--press-glow-spread) var(--press-glow-color);
  filter: blur(8px);
}

/* Triggered state (JS adds .is-pressing briefly) */
.press-glow.is-pressing{
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--press-glow-color) 60%, transparent);
}

.press-glow.is-pressing::after{
  animation: press-glow-pop var(--press-glow-duration) ease-out;
}

/* Keyframes: quick bloom then fade */
@keyframes press-glow-pop{
  0%   { opacity: 0;   box-shadow: 0 0 0 0 var(--press-glow-color); }
  25%  { opacity: .75; box-shadow: 0 0 0 var(--press-glow-spread) var(--press-glow-color); }
  100% { opacity: 0;   box-shadow: 0 0 0 0 var(--press-glow-color); }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .press-glow.is-pressing::after{ animation-duration: 1ms; }
}

/* XP Float */
.xp-float{
  position:absolute; left:50%; transform:translateX(-50%); bottom: -8px;
  background:rgba(32,255,163,.12); border:1px solid rgba(32,255,163,.35); color:#2aff9f;
  padding:8px 12px; border-radius:12px; font-weight:800; animation:rise 1800ms ease forwards; pointer-events:none
}
@keyframes rise{ 0%{opacity:0; transform:translate(-50%, 10px) scale(.9)} 20%{opacity:1; transform:translate(-50%, 0) scale(1)} 100%{opacity:0; transform:translate(-50%, -60px) scale(.95)} }

/* Creator / Settings helpers */
.creator-wrap{ max-width:min(1160px, 100%); margin:var(--space) auto; padding:0 var(--space) }
.creator-card .preview{ display:grid; place-items:center; }
.preview-window{ width:240px; height:240px; border-radius:16px; border:1px solid #223055; background:rgba(255,255,255,.03); display:grid; place-items:center; position:relative }
.creator-name input{ width:100%; text-align:center }

.creator-grid{ display:grid; gap:var(--space); grid-template-columns: 1fr; }
@media (min-width: 900px){ .creator-grid{ grid-template-columns: 1fr 1fr; } }

.avatar-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(110px,1fr)); gap:12px }
.avatar-card{ border:1px solid #223055; border-radius:12px; padding:10px; background:#0f1528; display:grid; gap:8px; place-items:center }
.swatches{ display:flex; gap:8px; flex-wrap:wrap }
.swatch{ width:44px; height:36px; border-radius:10px; border:2px solid #223055; background:var(--c); cursor:pointer }

/* Settings layout */
.settings-grid{ display:grid; gap:var(--space); grid-template-columns:1fr; }
@media (min-width: 900px){ .settings-grid{ grid-template-columns:1fr 1fr } }
.pet-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(130px,1fr)); gap:12px }
.pet-card{ border:1px solid #223055; border-radius:12px; padding:10px; background:#0f1528; display:grid; place-items:center; gap:8px }
.pet-card img{ width:80px; height:80px; object-fit:contain; image-rendering:pixelated }

/* Loot page */
.loot-grid{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:12px }
@media (min-width: 800px){ .loot-grid{ grid-template-columns:1fr 1fr } }
.loot-card{ display:grid; grid-template-columns:80px 1fr; gap:12px; align-items:center; border:1px solid #223055; border-radius:12px; background:#0f1528; padding:12px }

/* Footer */
.foot{ text-align:center; padding:18px; color:var(--muted); padding-bottom: calc(18px + env(safe-area-inset-bottom, 0px)) }

/* Mobile drawer docking & safe area */
@media (max-width: 760px){
  #drawer{ position: sticky; bottom:0; z-index:40; backdrop-filter: blur(10px) }
  body{ padding-bottom: env(safe-area-inset-bottom, 0px) }
}

/* Reduce gap between top (avatar/topic/xp) and problem area */
.stage{ gap: calc(var(--space) * 0.7); }
.hud-top{ margin-bottom: 0; }

/* Problem panel compaction */
#drawer, .drawer{ 
  margin-top: -8px;            /* pull up */
  padding-top: 8px;            /* lighter top padding */
}
.drawer .prob-head{ 
  margin-bottom: 6px;
}
.prompt.pretty{
  margin: 6px 0;
  padding: 8px 10px;
}
.answer-row{ 
  margin-top: 8px;
}
.feedback{
  margin-top: 6px;
  min-height: 0;               /* if you previously reserved a tall space */
}

/* If the header used to reserve space for streak/solving, collapse layout */
.drawer .prob-head{
  display: grid;
  grid-template-columns: 1fr;  /* single column now */
  align-items: center;
}

/* Ensure the on-screen keyboard doesn’t add extra blank space when hidden */
#kbd:not(.open){ margin-top: 0; }

/* --- Keyboard toggle visibility / stacking fixes --- */
#kbdToggle{ position:relative; z-index:10; display:inline-flex; }
#avatarBG{ pointer-events:none; }         /* overlays don’t eat clicks */
#pixelCharContainer{ position:relative; z-index:1; }
.header,.toolbar,#toolbar{ overflow:visible; }


/* If any parent clipped it on wide layouts */
.header, .toolbar, #toolbar { overflow:visible; }

/* Make the panel show/hide predictably */
#kbd[hidden] { display:none !important; }
#kbd.open { display:block; }

