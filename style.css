:root{
  --bg:#0b0f19; --card:#12182a; --glass:rgba(18,24,42,0.65); --text:#f3f6fb; --muted:#a7b1c2;
  /* default (blue) */
  --accent:#6aa6ff; --accent-2:#9bc2ff; --ok:#11c46a; --bad:#ff5468;
  --glow: 0 0 12px rgba(106,166,255,.45), 0 0 30px rgba(106,166,255,.25);
  --radius:16px;
  --space: clamp(10px, 2.4vw, 18px); --text-size: clamp(15px, 1.9vw, 17px);
  --h2-size: clamp(18px, 2.5vw, 22px); --prompt-size: clamp(20px, 3.2vw, 28px);
}

/* Themes */
html[data-theme="blue"]{ --accent:#6aa6ff; --accent-2:#9bc2ff; --glow: 0 0 12px rgba(106,166,255,.45), 0 0 30px rgba(106,166,255,.25); }
html[data-theme="pink"]{ --accent:#ff78c4; --accent-2:#ffc2e3; --glow: 0 0 12px rgba(255,120,196,.45), 0 0 30px rgba(255,120,196,.25); }
html[data-theme="burgundy"]{ --accent:#a33a4a; --accent-2:#cf6b7c; --glow: 0 0 12px rgba(163,58,74,.5), 0 0 30px rgba(163,58,74,.3); }
html[data-theme="green"]{ --accent:#4bdc84; --accent-2:#9df2c0; --glow: 0 0 12px rgba(75,220,132,.5), 0 0 30px rgba(75,220,132,.3); }
html[data-theme="yellow"]{ --accent:#ffd24d; --accent-2:#ffe9a1; --glow: 0 0 12px rgba(255,210,77,.5), 0 0 30px rgba(255,210,77,.3); }

*{box-sizing:border-box}
html,body{
  margin:0; padding:0;
  background:linear-gradient(160deg,#0a0e18 0%,#0d1222 60%,#0b0f19 100%);
  color:var(--text);
  font-family:"Source Code Pro",ui-monospace,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  font-size:var(--text-size);
}
img{max-width:100%;display:block}

/* Header */
.topbar{
  position:sticky; top:0; z-index:50;
  display:flex; justify-content:space-between; align-items:center;
  padding:calc(var(--space)*0.6) var(--space);
  background:rgba(8,12,22,.7); backdrop-filter:blur(10px);
  border-bottom:1px solid #1c2540;
}
.brand{font-weight:700; letter-spacing:.4px; font-size:var(--h2-size)}

.hud{display:flex; gap:var(--space); align-items:center; flex-wrap:wrap}
.hud-info{min-width:220px}
.hud-row{display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; font-weight:700}
.level{background:linear-gradient(180deg,#2a3250,#1d253d); padding:4px 8px; border-radius:8px; border:1px solid #2b3659}
.xp-val{color:var(--muted)}
.xp-track{height:8px; background:#0d1324; border-radius:9px; border:1px solid #233056; overflow:hidden; width: clamp(140px, 28vw, 220px); }
.xp-bar{height:100%; width:0; background:linear-gradient(90deg,var(--accent),var(--accent-2)); box-shadow:var(--glow); transition:width .6s cubic-bezier(.2,.8,.2,1)}
.player-name{ margin-top:6px; color:var(--muted); font-weight:600 }
.top-actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.theme-select-label{ display:flex; gap:6px; align-items:center; color:var(--muted) }
.theme-select, .select{
  background:#0f1427; border:1px solid #223055; color:var(--text);
  padding:10px 12px; border-radius:10px; font-weight:700;
}

/* Layout */
.wrap{ max-width:min(1100px, 100vw - 2*var(--space)); margin:var(--space) auto; padding:0 var(--space); display:grid; gap:var(--space); }
.card{ background:var(--glass); border:1px solid #1c2540; border-radius:var(--radius); padding:var(--space); box-shadow:0 10px 30px rgba(0,0,0,.25) }

/* Stage */
.stage{ display:grid; gap:var(--space); align-items:center; justify-items:center }
.avatar-stage{ width: clamp(160px, 48vw, 360px); height: clamp(160px, 48vw, 360px); display:grid; place-items:center; }

/* Drawer (problem panel) */
.drawer .prob-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
.streak{color:var(--muted); font-weight:700; white-space:nowrap}
.prompt.pretty{
  min-height:64px; line-height:1.6; font-size:var(--prompt-size);
  padding:10px 12px; border-radius:12px; background:rgba(255,255,255,0.02); border:1px dashed #223055
}
mjx-container[jax="CHTML"]{ font-size:120% !important }
.answer-row{ margin-top:14px }
.answer-row input{
  width:100%; background:#0f1427; border:1px solid #223055; color:var(--text);
  padding:14px 16px; border-radius:12px; font-size:18px; outline:none; transition:border-color .2s, box-shadow .2s
}
.answer-row input:focus{ border-color:var(--accent); box-shadow:var(--glow) }
.actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:12px }
.btn{
  padding:12px 16px; border-radius:12px; border:1px solid #223055;
  background:linear-gradient(180deg,#0f1528,#0a0f1f); color:var(--text);
  font-weight:700; cursor:pointer; transition:transform .12s, box-shadow .2s, border-color .2s
}
.btn.small{ padding:8px 10px; border-radius:10px; font-size:.95em }
.btn:hover{ transform:translateY(-1px); box-shadow:var(--glow); border-color:var(--accent) }
.btn-primary{ background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#0b1020; border:none }
.btn-ghost{ background:transparent }
.only-mobile{ display:none }

.feedback{ min-height:28px; margin-top:10px; font-weight:700 }
.feedback.ok{ color:var(--ok) }
.feedback.bad{ color:var(--bad) }

/* Keyboard inside drawer */
.kbd{ margin-top:10px; display:none }
.kbd.open{ display:block }
.kbd-grid{ display:grid; grid-template-columns: repeat(6, 1fr); gap:8px }
.kbd-grid button{
  padding:12px 10px; border-radius:10px; border:1px solid #223055; background:#0f1528; color:var(--text);
  font-weight:800; letter-spacing:.2px
}
.kbd-grid button:hover{ border-color:var(--accent); box-shadow:var(--glow) }
.kbd-grid .wide{ grid-column: span 2 }
.kbd-grid .primary{ background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#0b1020; border:none }
.kbd-grid .accent{ color:#0b1020; background:linear-gradient(180deg,#ffd24d,#ffe9a1); border:none }
.kbd-grid .danger{ border-color:#3b2330; background:#1b0f16; color:#ffb1c1 }

/* XP floating chip (slower, from feedback area bottom) */
.xp-float{
  position:absolute; left:50%; transform:translateX(-50%); bottom: -8px;
  background:rgba(32,255,163,.12); border:1px solid rgba(32,255,163,.35); color:#2aff9f;
  padding:8px 12px; border-radius:12px; font-weight:700; animation:rise 1600ms ease forwards; pointer-events:none
}
@keyframes rise{
  0%{opacity:0; transform:translate(-50%, 10px) scale(.9)}
  20%{opacity:1; transform:translate(-50%, 0) scale(1)}
  100%{opacity:0; transform:translate(-50%, -60px) scale(.95)}
}

/* Mobile-specific behavior: dock drawer to bottom and show keyboard toggle */
@media (max-width: 760px){
  .layout{ gap: var(--space); }
  .only-mobile{ display:inline-block }
  /* Bottom docking */
  #drawer{
    position: sticky;
    bottom: 0;
    z-index: 40;
    /* give it punch visually */
    backdrop-filter: blur(10px);
  }
  body{ padding-bottom: env(safe-area-inset-bottom, 0px); }
}

/* Safe-area handling */
@supports (padding: max(0px)){
  .topbar { padding-right: max(var(--space), env(safe-area-inset-right)); padding-left: max(var(--space), env(safe-area-inset-left)); }
  .foot { padding-bottom: max(calc(var(--space)*1.2), env(safe-area-inset-bottom)); }
}

/* Avatar block glow utility (shared) */
.block-glow{
  filter: drop-shadow(0 0 6px var(--accent)) drop-shadow(0 0 12px color-mix(in srgb, var(--accent) 40%, transparent));
}
